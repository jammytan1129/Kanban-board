<html>

<head>
    <%- include ../includes/_head%>
</head>

<body>
    <form id = "app" @submit="CheckForm" method="POST" novalidate="true">
        <%- include('../includes/_header')%>
        <div class="align-items-start mt-5 d-flex flip-card-3D-wrapper">
            <img class="logo" src="/public/images/logo.png" alt="">
            <div id="flip-card" >
                <div class="flip-card-front pb-3">
                    <div class="mx-2 px-4">
                        <div class="btn-group nav-item dropdown mt-5 mb-2">
                            <button class="column-button pointer upload-image-style" id="stage-menu" role="button" data-toggle="dropdown" aria-haspopup="true"
                            aria-expanded="false">
                                <img :src="loginUser.icon_url" height="100px;" width="100px;" class="rounded-circle mr-2" alt="">
                            </button>
                            <div class="dropdown-menu  p-3" aria-labelledby="stage-menu" style="min-width:170px;">
                                <div class="input-group justify-content-between align-items-center">
                                    <h6 class="m-0 text-center" style="font-weight:900;">Profile Picture</h6>
                                    <button type="button" class="close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" data-toggle="modal" data-target="#selectProfile">Select Picture</a>                                                                                                            
                            </div>
                        </div>
                        <div class="information my-2">
                            <div class="my-2 py-2">
                                <p class="text-light">Email</p>
                                <span class="email">{{loginUser.email}}</span>
                            </div>
                            <div class="my-2 py-2">
                                <p class="text-light">Name</p>
                                <input id="name" type="text" v-model="loginUser.name">
                                <span class="error-text">{{ error }}</span>
                            </div>
                            <div class="my-2 py-2">
                                <p class="text-light">Phone</p>
                                <input id="phone" type="text" v-model="loginUser.phone">
                            </div>
                            <div class="my-2 py-2">
                                <p class="text-light">Nick Name</p>
                                <input id="nick_name" type="text" v-model="loginUser.nick_name">
                            </div>
                        </div>
                        <div class="input-group d-flex justify-content-center my-3">
                            <input class="mx-2 btn-success btn" type="submit" value="Save">
                            <a class="mx-2 btn-light btn" href="/home">Cancel</a>
                        </div>
                    </div>
                </div> 
            </div>
        </div>
        <%- include ../modals/select_profile_modal%>
        <%- include ../includes/_footer%>
    </form>
</body>

<style>
    body {
        background-image: url(https://images.pexels.com/photos/952670/pexels-photo-952670.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260);
        background-repeat: no-repeat;
        background-attachment: fixed;
        background-position: center;
        background-size: cover;
    }

    @import url('https://fonts.googleapis.com/css?family=Open+Sans:300,600');

    html,
    body {
        background: ivory;
        font-family: 'Open Sans', sans-serif;
        background-image: url(https://images.pexels.com/photos/544917/pexels-photo-544917.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260);
        background-repeat: no-repeat;
        background-attachment: fixed;
        background-position: center;
        background-size: cover;
        color: #F0F8FF;
    }

    .logo {
        z-index: 1000;
        position: absolute;
        top: -30;
        right: -30;
        width: 42%;
        height: 37%;
        min-width: 130px;

    }

    .form-control {
        width: inherit;
    }

    html * {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    *,
    *:after,
    *:before {
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
    }


    .flip-card-3D-wrapper {
        width: 100%;
        height: 50%;
        max-width: 350px;
        min-width: 250px;
        position: relative;
        -o-perspective: 900px;
        -webkit-perspective: 900px;
        -ms-perspective: 900px;
        perspective: 900px;
        margin: 0 auto;
    }

    #flip-card {
        width: 100%;
        height: 100%;
        text-align: center;
        margin: 20px auto;        
        position: absolute;
    }


    #flip-card .flip-card-front,
    #flip-card .flip-card-back {
        width: 100%;
        -o-backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
        -ms-backface-visibility: hidden;
        backface-visibility: hidden;
        z-index: 2;
        -webkit-box-shadow: 2px 3px 32px 1px rgba(133, 133, 133, 0.71);
        -moz-box-shadow: 2px 3px 32px 1px rgba(133, 133, 133, 0.71);
        box-shadow: 2px 3px 32px 1px rgba(133, 133, 133, 0.71);
    }
    .flip-card-front{
        padding-bottom:5%;
        min-width: 320px;
    }

    #flip-card .flip-card-front {
        background: #747372;
        border-top: 5px solid #7A1737;
    }

    #flip-card .flip-card-back {
        background: #747372;
        border-top: 5px solid #7A1737;

    }

    .flip-card-back,
    .flip-card-front {
        border-radius: 20px;
    }

    #flip-card .flip-card-front p,
    #flip-card .flip-card-back p {
        color: grey;
        display: inline;
        text-align: right;
        /* width: 100%; */
    }

    #flip-card .flip-card-front .error-text,
    #flip-card .flip-card-back .error-text{
        color: #7A1737;
        display: inline-block;
        margin-left: 35%;
        margin-bottom: -10%;
    }
    .email {
        color: white;
        font-weight: bold;
        display: inline;
        margin-left: 25%;
    }
    input {
        float: right;
    }
    .information {
        text-align: left;
    }
    .column-button:hover{
        cursor: pointer;
    }
    .column-button{
        border-width: 0px;
        border-radius: 5px;
        background-color: rgba(0,0,0,0);
    }
    .dropdown-item:hover {
        background-color: #8A8788;
        color: white;
        cursor: pointer;
    }
    .text-light{
        line-height: 35px;
    }
    .btn-select-profile{
        border-radius: 10px;
        border: 0px;
        padding-left: 20px;
        padding-right: 20px;
        padding-top: 10px;
        padding-bottom: 10px;
        background-color:rgba(0,0,0,0);
    }
    .select-profile-background{
        background-color: rgba(21, 68, 95, 0.5)
    }
    .select-profile{
        max-width: 400px;
    }
    .upload-image-style:focus {
        outline: none;
    }
    .profile-icon{
        display:flex;
        justify-content:center;
    }
</style>

<script>
    var vm = new Vue({
        el: '#app',
        name: 'mfgActivity',
        data: {
            error: '',
            board: {
                name: 'Kanban'
            },
            loginUser: {},
            boardTitle:'',
            isEditBoardTitle: false,
            icon_urls: [
                "/public/icon/profile/001-man.png",
                "/public/icon/profile/002-boy.png",
                "/public/icon/profile/003-girl.png",
                "/public/icon/profile/004-girl-1.png",
                "/public/icon/profile/005-girl-2.png",
                "/public/icon/profile/006-girl-3.png",
                "/public/icon/profile/007-girl-4.png",
                "/public/icon/profile/021-man-1.png",
                "/public/icon/profile/022-boy-1.png",
                "/public/icon/profile/025-boy-2.png"
            ]
        },
        watch: {

        },
        methods: {
            SaveUserProfile: function () {
                const {board_list, ...info} = this.loginUser
                $.ajax({
                    type: 'POST',
                    url: '/saveUserInfo',
                    data: info,
                    success: response => {
                        window.location.href = '/home'; 
                        console.log(response);
                    },
                    error: function (xhr, textStatus, error) {
                        console.log(error);
                    }
                });
            },
            CheckForm: function (e) {
                this.error = '';

                if (!this.loginUser.name.trim()) {
                    console.log("check form no name");
                    this.error = 'Name required';
                } 
                if (this.error == '') {
                    console.log("check form no error");
                    this.SaveUserProfile();
                }

                e.preventDefault();

            },
            EditBoardTitle: function() {

            },
            CancelEditBoardTitle: function() {

            },
            DoneEditBoardTitle: function() {
                
            },
            SelectProfilePicture: function() {

            },
            DoneSelectProfilePicture: function(icon_url){
                this.loginUser.icon_url = icon_url;
                console.log("selected icon url");
            }
            
        },

        mounted() {
            $.ajax({
                type: 'GET',
                url: '/userInfo',
                success: user => {
                    this.loginUser = user;
                },
                error: function (xhr, textStatus, error) {
                    console.log(error);
                }
            });
        }
})
</script>

</html>